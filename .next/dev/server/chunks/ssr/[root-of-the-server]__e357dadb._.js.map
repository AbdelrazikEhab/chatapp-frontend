{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///F:/ChatAppTask/front/utils/socket.ts"],"sourcesContent":["import { io, Socket } from 'socket.io-client';\n\nlet socket: Socket | null = null;\n\nexport function connectSocket(token: string) {\n  if (socket) return socket;\n  socket = io((process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000') as string, {\n    query: { token },\n    transports: ['websocket']\n  });\n  return socket;\n}\n\nexport function closeSocket() {\n  if (!socket) return;\n  socket.disconnect();\n  socket = null;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,IAAI,SAAwB;AAErB,SAAS,cAAc,KAAa;IACzC,IAAI,QAAQ,OAAO;IACnB,SAAS,IAAA,kJAAE,EAAE,6DAAmC,yBAAoC;QAClF,OAAO;YAAE;QAAM;QACf,YAAY;YAAC;SAAY;IAC3B;IACA,OAAO;AACT;AAEO,SAAS;IACd,IAAI,CAAC,QAAQ;IACb,OAAO,UAAU;IACjB,SAAS;AACX","debugId":null}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///F:/ChatAppTask/front/pages/chat.tsx"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { connectSocket, closeSocket } from '../utils/socket';\nimport type { Socket } from 'socket.io-client';\nimport axios from 'axios';\n\ntype Message = {\n  username?: string;\n  text?: string;\n  url?: string;\n  createdat?: number;\n  created_at?: string;\n  sender_name?: string;\n};\n\nexport default function ChatPage() {\n  const [socket, setSocket] = useState<Socket | null>(null);\n  const [room, setRoom] = useState('general');\n  const [username, setUsername] = useState('');\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [users, setUsers] = useState<string[]>([]);\n  const [connected, setConnected] = useState(false);\n  const [insights, setInsights] = useState<string>('');\n  const [loadingInsights, setLoadingInsights] = useState(false);\n  const messagesRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      window.location.href = '/login';\n      return;\n    }\n\n    const s = connectSocket(token);\n    setSocket(s);\n\n    s.on('connect', () => setConnected(true));\n\n    s.on('roomHistory', (history: any[]) => {\n      setMessages(history.map(h => ({ ...h })));\n      setTimeout(() => messagesRef.current?.scrollTo({ top: messagesRef.current.scrollHeight }), 50);\n    });\n\n    s.on('message', (m: any) => {\n      setMessages(prev => [...prev, m]);\n      setTimeout(() => messagesRef.current?.scrollTo({ top: messagesRef.current.scrollHeight }), 50);\n    });\n\n    s.on('locationmessage', (m: any) => setMessages(prev => [...prev, m]));\n\n    s.on('roomData', (data: any) => setUsers(data.users.map((u: any) => u.username)));\n\n    return () => {\n      closeSocket();\n      setSocket(null);\n    };\n  }, []);\n\n  const join = () => {\n    if (!socket) return;\n    socket.emit('join', { username: username || 'anon', room }, (error: any) => {\n      if (error) alert(error);\n    });\n  };\n\n  const send = (e?: React.FormEvent) => {\n    e?.preventDefault();\n    if (!socket || !message.trim()) return;\n    socket.emit('SendMessage', message, (err: any) => {\n      if (err) alert(err);\n    });\n    setMessage('');\n  };\n\n  const shareLocation = () => {\n    if (!socket || !navigator.geolocation) return alert('Location not supported');\n    navigator.geolocation.getCurrentPosition(pos => {\n      socket.emit(\n        'SendLocation',\n        { latitude: pos.coords.latitude, longitude: pos.coords.longitude },\n        () => console.log('Location shared')\n      );\n    });\n  };\n\n  /** AI INSIGHTS PANEL **/\n  const fetchInsights = async () => {\n    setLoadingInsights(true);\n    setInsights('');\n    try {\n      const res = await axios.get(\n        (process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000') +\n          `/api/ai/insights/${room}`\n      );\n      setInsights(res.data.insights || 'No insights generated.');\n    } catch (err: any) {\n      console.error(err);\n      setInsights('Failed to fetch AI insights.');\n    } finally {\n      setLoadingInsights(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col md:flex-row\">\n      {/* Sidebar */}\n      <aside className=\"w-full md:w-1/4 bg-white p-4 border-r\">\n        <h2 className=\"font-semibold mb-2\">Rooms</h2>\n        <div className=\"space-y-2\">\n          <input\n            value={room}\n            onChange={e => setRoom(e.target.value)}\n            className=\"w-full p-2 border rounded\"\n          />\n          <input\n            value={username}\n            onChange={e => setUsername(e.target.value)}\n            className=\"w-full p-2 border rounded\"\n            placeholder=\"username\"\n          />\n          <button\n            onClick={join}\n            className=\"w-full bg-blue-600 text-white p-2 rounded mt-2\"\n          >\n            Join\n          </button>\n        </div>\n        <div className=\"mt-6\">\n          <h3 className=\"font-medium\">Online</h3>\n          <ul className=\"mt-2\">\n            {users.map(u => (\n              <li key={u} className=\"text-sm\">\n                {u}\n              </li>\n            ))}\n          </ul>\n        </div>\n      </aside>\n\n      {/* Chat Messages */}\n      <main className=\"flex-1 flex flex-col\">\n        <div\n          ref={messagesRef}\n          id=\"messages\"\n          className=\"flex-1 overflow-auto p-4 space-y-3 bg-gray-50\"\n        >\n          {messages.map((m, i) => (\n            <div key={i} className=\"bg-white p-3 rounded shadow-sm\">\n              <div className=\"text-xs text-gray-500\">\n                {m.username || m.sender_name} •{' '}\n                {m.created_at ||\n                  (m.createdat\n                    ? new Date(m.createdat).toLocaleTimeString()\n                    : '')}\n              </div>\n              {m.text && <div className=\"mt-1\">{m.text}</div>}\n              {m.url && (\n                <a\n                  className=\"text-blue-600\"\n                  href={m.url}\n                  target=\"_blank\"\n                  rel=\"noreferrer\"\n                >\n                  Shared location\n                </a>\n              )}\n            </div>\n          ))}\n        </div>\n\n        <form onSubmit={send} className=\"p-4 bg-white border-t flex gap-2\">\n          <input\n            value={message}\n            onChange={e => setMessage(e.target.value)}\n            className=\"flex-1 p-2 border rounded\"\n            placeholder=\"Type a message...\"\n          />\n          <button\n            type=\"button\"\n            onClick={shareLocation}\n            className=\"px-4 py-2 border rounded\"\n          >\n            Location\n          </button>\n          <button className=\"px-4 py-2 bg-blue-600 text-white rounded\">\n            Send\n          </button>\n        </form>\n      </main>\n\n      {/* AI Insights Panel */}\n      <aside className=\"w-full md:w-1/4 bg-white p-4 border-l flex flex-col\">\n        <h3 className=\"font-semibold mb-2\">AI Insights</h3>\n\n        {!insights && (\n          <div className=\"text-sm text-gray-600\">\n            Click below to analyze this room’s conversation using AI.\n          </div>\n        )}\n\n        <button\n          onClick={fetchInsights}\n          disabled={loadingInsights}\n          className=\"mt-4 px-3 py-2 bg-blue-600 text-white rounded\"\n        >\n          {loadingInsights ? 'Analyzing...' : 'Generate Insights'}\n        </button>\n\n        {insights && (\n          <div className=\"mt-4 bg-gray-100 p-3 rounded border text-sm whitespace-pre-wrap\">\n            {insights}\n          </div>\n        )}\n      </aside>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}